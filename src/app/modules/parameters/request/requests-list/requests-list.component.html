<div class="table-wraper">
  <table *ngIf="table.rows.length > 0; else elseBlock" class="striped table">
    <thead>
      <tr class="tr-head">
        <th *ngFor="let col of table.columnNames">{{ col }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of table.rows" class="row">
        <td>{{ row.id }}</td>
        <td>
          {{ row.advisor.firstName }} {{ row.advisor.firtsLastName }} <br />
          C.C.{{ row.advisor.documentNumber }}
        </td>
        <td>{{ row.property.city.department.departmentName }}</td>
        <td>{{ row.property.city.cityName }}</td>
        <td>{{ row.property.address }}</td>
        <td>{{ row.property.propertyType.typeName }}</td>
        <td>{{ row.requestStatus.statusName }}</td>
        <td class="actions">
          <!-- View details -->
          <i
            attr.data-target="{{ idProjectModalViewDetails }}"
            class="action-button fa-regular fa-eye modal-trigger"
            title="Ver detalles"
            (click)="viewPropertyDetails(row.propertyId)"
          ></i>
          <!-- Download advisor -->
          <i
            *ngIf="row.contractSource && row.contractSource != '' && isAdvisor"
            class="action-button fa-regular fa-circle-down"
            title="Decargar contrato"
            (click)="downLoadContract(row.contractSource)"
          ></i>
          <!-- Download contract -->
          <i
            *ngIf="
              row.contractSource &&
              row.contractSource != '' &&
              row.requestStatus?.id == 7 &&
              isCustomer
            "
            class="action-button fa-regular fa-circle-down"
            title="Decargar contrato"
            (click)="downLoadContract(row.contractSource)"
          ></i>
          <!-- Upload contract advisor-->

          <label
            for="fileInput"
            *ngIf="
              (row.requestStatus?.id == 2 ||
                row.requestStatus?.id == 3 ||
                row.requestStatus?.id == 7 ||
                row.requestStatus?.id == 4 ||
                row.requestStatus?.id == 5 ||
                row.requestStatus?.id == 10 ||
                row.requestStatus?.id == 11) &&
              isAdvisor
            "
          >
            <i
              class="action-button fa-solid fa-file-arrow-up"
              title="Cargar formato de contrato"
            ></i>
          </label>
          <!-- Upload contract customer-->
          <label
            for="fileInput"
            *ngIf="row.requestStatus?.id == 7 && isCustomer"
          >
            <i
              class="action-button fa-solid fa-file-arrow-up"
              title="Cargar contrato"
            ></i>
          </label>
          <input
            id="fileInput"
            type="file"
            style="display: none"
            (change)="upload($event, row.id)"
          />
          <!-- Upload codeptor format by advisor-->
          <label
            for="fileInputCodeptor"
            *ngIf="(row.requestStatus?.id == 2 || row.requestStatus?.id == 12) && isAdvisor"
          >
            <i
              class="action-button fa-solid fa-arrow-up-from-bracket"
              title="Cargar formato codeudor"
            ></i>
          </label>
          <input
            id="fileInputCodeptor"
            type="file"
            style="display: none"
            (change)="uploadFormatCodeptor($event, row.id)"
          />
          <!-- Download documents codeptor -->
          <i
            *ngIf="
              row.codeptorDocumentsSource &&
              row.codeptorDocumentsSource != '' &&
              row.requestStatus?.id == 3 &&
              isAdvisor
            "
            class="action-button fa-regular fa-circle-down"
            title="Descargar documentos codeudor"
            (click)="downLoadCodeptorDocuments(row.codeptorDocumentsSource, row.advisorId, row.id)"
          ></i>
          <!-- Reassign request -->
          <i
            *ngIf="isAdmin"
            attr.data-target="{{ idProjectChangeAdvisor }}"
            class="action-button fa-solid fa-people-arrows modal-trigger"
            title="Reasignar"
          ></i>
          <!-- To estudio-->
          <i
            data-target="confirm-modal-3"
            *ngIf="
              (row?.requestStatus?.id == 1 || row.requestStatus?.id == 12) &&
              isAdvisor
            "
            class="action-button fa-solid fa-book modal-trigger"
            title="Pasar a estudio"
            (click)="changeStatus(row.advisorId, row.id, 2, false)"
          ></i>
          <!-- To estudio codeudor-->
          <i
            data-target="confirm-modal-3"
            *ngIf="
              (row?.requestStatus?.id == 2 || row.requestStatus?.id == 12) &&
              isAdvisor
            "
            class="action-button fa-regular fa-address-book modal-trigger"
            title="Pasar a estudio con codeudor"
            (click)="changeStatus(row.advisorId, row.id, 3,false)"
          ></i>
          <!-- To pendiente contrato-->
          <i
            data-target="confirm-modal-3"
            *ngIf="
              (row?.requestStatus?.id == 2 || row.requestStatus?.id == 3) &&
              isAdvisor
            "
            class="action-button fa-solid fa-file-signature modal-trigger"
            title="Pasar a pendiente por contrato"
            (click)="changeStatus(row.advisorId, row.id, 7, false)"
          ></i>
          <!-- To rechazada-->
          <i
            data-target="confirm-modal-3"
            *ngIf="
              (row?.requestStatus?.id == 2 || row.requestStatus?.id == 3) &&
              isAdvisor
            "
            class="action-button fa-regular fa-circle-xmark modal-trigger"
            title="Rechazar"
            (click)="changeStatus(row.advisorId, row.id, 12, true)"
          ></i>
          <!-- To aceptada sin codeudor-->
          <i
            data-target="confirm-modal-3"
            *ngIf="row?.requestStatus?.id == 7 && isAdvisor"
            class="action-button fa-regular fa-circle-check modal-trigger"
            title="Aceptar sin codeudor"
            (click)="changeStatus(row.advisorId, row.id, 4,true)"
          ></i>
          <!-- To aceptada con codeudor-->
          <i
            data-target="confirm-modal-3"
            *ngIf="row?.requestStatus?.id == 7 && isAdvisor"
            class="action-button fa-solid fa-user-check modal-trigger"
            title="Aceptar con codeudor"
            (click)="changeStatus(row.advisorId, row.id, 5, true)"
          ></i>
          <!-- To abortada cliente-->
          <i
            data-target="confirm-modal-3"
            *ngIf="
              (row?.requestStatus?.id == 2 ||
                row.requestStatus?.id == 3 ||
                row.requestStatus?.id == 7) &&
              isAdvisor
            "
            class="action-button fa-solid fa-ban modal-trigger modal-trigger"
            title="Abortar por cliente"
            (click)="changeStatus(row.advisorId, row.id, 8, true)"
          ></i>
          <!-- To abortada akin-->
          <i
            data-target="confirm-modal-3"
            *ngIf="row.requestStatus?.id == 7 && isAdvisor"
            class="action-button fa-solid fa-power-off modal-trigger"
            title="Abortar por Akin"
            (click)="changeStatus(row.advisorId, row.id, 9, true)"
          ></i>
          <!-- To incumplimiento akin-->
          <i
            data-target="confirm-modal-3"
            *ngIf="row.requestStatus?.id == 4 && isAdvisor"
            class="action-button fa-solid fa-skull modal-trigger"
            title="Incumplimiento por Akin"
            (click)="changeStatus(row.advisorId, row.id, 10, true)"
          ></i>
          <!-- To incumplimiento cliente-->
          <i
            data-target="confirm-modal-3"
            *ngIf="row.requestStatus?.id == 4 && isAdvisor"
            class="action-button fa-solid fa-face-dizzy modal-trigger"
            title="Incumplimiento por cliente"
            (click)="changeStatus(row.advisorId, row.id, 11, true)"
          ></i>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<ng-template #elseBlock>
  <div class="no-data">
    <span> No hay solicitudes para listar </span>
  </div>
</ng-template>

<app-projector-modal
  [idModal]="idProjectModalViewDetails"
  [title]="'Detalles de la solicitud'"
  [description]="''"
>
  <div>
    <app-request-detail #requestDetail></app-request-detail>
  </div>
</app-projector-modal>

<!-- TODO: Cambiar esto por un confirm modal -->
<app-projector-modal
  [idModal]="idProjectChangeAdvisor"
  [title]="'advisor'"
  [description]="''"
>
  <div>Este es el del advisor</div>
</app-projector-modal>

<app-commentary-modal
  [title]="'Â¿Esta seguro que quiere cambiar el estado?'"
  [description]="'Ingrese un comentario'"
  [withComment]="withCommentary"
  (response)="responseModal($event)"
></app-commentary-modal>
